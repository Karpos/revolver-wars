SET(SRCS
		AssemblyInfo.cpp
		DllMain.cpp
		ManagedLuaPlus.cpp
		ManagedLuaPlus.h
		StdAfx.h
	)

ADD_DEFINITIONS(-D_CRT_SECURE_NO_DEPRECATE -D_CRT_NONSTDC_NO_DEPRECATE -DLUAPLUS_DLL)

INCLUDE_DIRECTORIES(..)

MACRO(COPY_FILE Source Destination VAR)
	ADD_CUSTOM_COMMAND(OUTPUT ${Destination}
		COMMAND ${CMAKE_COMMAND} -E copy ${Source} ${Destination}
		DEPENDS ${Source})
	LIST(APPEND ${VAR} ${Destination})
ENDMACRO(COPY_FILE)

COPY_FILE(${CMAKE_CURRENT_SOURCE_DIR}/ManagedLuaPlus.snk ${CMAKE_CURRENT_BINARY_DIR}/ManagedLuaPlus.snk SRCS)

ADD_LIBRARY(ManagedLuaPlus SHARED ${SRCS})
TARGET_LINK_LIBRARIES(ManagedLuaPlus LuaPlusShared DELAYIMP)

GET_TARGET_PROPERTY(ManagedLuaPlus_PATH ManagedLuaPlus LOCATION)
ADD_CUSTOM_COMMAND(TARGET ManagedLuaPlus POST_BUILD COMMAND sn -R ${ManagedLuaPlus_PATH} ${CMAKE_CURRENT_SOURCE_DIR}/ManagedLuaPlus.snk)

SET_SOURCE_FILES_PROPERTIES(AssemblyInfo.cpp ManagedLuaPlus.cpp PROPERTIES COMPILE_FLAGS "/clr:oldSyntax /EHa")
SET_TARGET_PROPERTIES(ManagedLuaPlus PROPERTIES LINK_FLAGS "/DELAYLOAD:LuaPlus_1100.debug.dll /DELAYLOAD:LuaPlus_1100.dll")

LUAPLUS_FIX_TARGET(ManagedLuaPlus)

#INSTALL(TARGETS LuaPlusShared
#	RUNTIME DESTINATION ${CMAKE_INSTALL_PREFIX}/bin)