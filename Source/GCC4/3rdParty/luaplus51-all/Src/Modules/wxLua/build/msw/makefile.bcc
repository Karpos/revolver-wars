# =========================================================================
#     This makefile was generated by
#     Bakefile 0.2.3 (http://www.bakefile.org)
#     Do not modify, all changes will be overwritten!
# =========================================================================

.autodepend

!ifndef BCCDIR
!ifndef MAKEDIR
!error Your Borland compiler does not define MAKEDIR. Please define the BCCDIR variable, e.g. BCCDIR=d:\bc4
!endif
BCCDIR = $(MAKEDIR)\..
!endif



# -------------------------------------------------------------------------
# These are configurable options:
# -------------------------------------------------------------------------

# C compiler 
!ifndef CC
CC = bcc32
!endif

# C++ compiler 
!ifndef CXX
CXX = bcc32
!endif

# Standard flags for CC 
!ifndef CFLAGS
CFLAGS = 
!endif

# Standard flags for C++ 
!ifndef CXXFLAGS
CXXFLAGS = 
!endif

# Standard preprocessor flags (common for CC and CXX) 
!ifndef CPPFLAGS
CPPFLAGS = -a8 -g0
!endif

# Standard linker flags 
!ifndef LDFLAGS
LDFLAGS = 
!endif

# Builds in debug mode [debug,release]
!ifndef BUILD
BUILD = debug
!endif

# Builds in Unicode mode [0,1]
!ifndef UNICODE
UNICODE = 0
!endif

# Builds in shared mode [0,1]
!ifndef SHARED
SHARED = 0
!endif

# Use DLL build of wx library? [0,1]
!ifndef WX_SHARED
WX_SHARED = 0
!endif

# Version of the wx library to build against. 
!ifndef WX_VERSION
WX_VERSION = 28
!endif

# Use monolithic build of wxWidgets? [0,1]
!ifndef WX_MONOLITHIC
WX_MONOLITHIC = 0
!endif

# The directory where wxWidgets library is installed 
!ifndef WX_DIR
WX_DIR = $(WXWIN)
!endif

# Should the wxLua applications be compiled ? [0,1]
!ifndef USE_APPS
USE_APPS = 1
!endif

# Should wxLua use the system-wide Lua library ? [0,1]
!ifndef USE_SYSTEM_LUA
USE_SYSTEM_LUA = 0
!endif

# The path to the Lua library includes 
!ifndef LUA_INCLUDE_DIR
LUA_INCLUDE_DIR = ..\..\..\modules\lua\include
!endif

# The path to the Lua library libs 
!ifndef LUA_LIB_DIR
LUA_LIB_DIR = ..\..\..\modules\lua\lib
!endif

# This is an advanced option. Handle with care.
# Version of C runtime library to use. You can change this to
# static if SHARED=0, but it is highly recommended to not do
# it if SHARED=1 unless you know what you are doing. [dynamic,static]
!ifndef RUNTIME_LIBS
RUNTIME_LIBS = dynamic
!endif

# This is an advanced option. Handle with care.
# The thread model to use: use 'multi' default to allow
# multi-threading. [multi,single]
!ifndef THREADING
THREADING = multi
!endif

# Do the wxLua bindings for the wxAdv lib need to be compiled ? [0,1]
!ifndef USE_WXBINDADV
USE_WXBINDADV = 1
!endif

# Do the wxLua bindings for the wxAUI lib need to be compiled ? [0,1]
!ifndef USE_WXBINDAUI
USE_WXBINDAUI = 1
!endif

# Do the wxLua bindings for the wxBase lib need to be compiled ? [0,1]
!ifndef USE_WXBINDBASE
USE_WXBINDBASE = 1
!endif

# Do the wxLua bindings for the wxCore lib need to be compiled ? [0,1]
!ifndef USE_WXBINDCORE
USE_WXBINDCORE = 1
!endif

# Do the wxLua bindings for the wxGL lib need to be compiled ? [0,1]
!ifndef USE_WXBINDGL
USE_WXBINDGL = 1
!endif

# Do the wxLua bindings for the wxHTML lib need to be compiled ? [0,1]
!ifndef USE_WXBINDHTML
USE_WXBINDHTML = 1
!endif

# Do the wxLua bindings for the wxMedia lib need to be compiled ? [0,1]
!ifndef USE_WXBINDMEDIA
USE_WXBINDMEDIA = 1
!endif

# Do the wxLua bindings for the wxNet lib need to be compiled ? [0,1]
!ifndef USE_WXBINDNET
USE_WXBINDNET = 1
!endif

# Do the wxLua bindings for the wxRichText lib need to be compiled ? [0,1]
!ifndef USE_WXBINDRICHTEXT
USE_WXBINDRICHTEXT = 0
!endif

# Do the wxLua bindings for wxSTC need to be compiled ? [0,1]
!ifndef USE_WXBINDSTC
USE_WXBINDSTC = 1
!endif

# Do the wxLua bindings for wxXML need to be compiled ? [0,1]
!ifndef USE_WXBINDXML
USE_WXBINDXML = 1
!endif

# Do the wxLua bindings for wxXRC need to be compiled ? [0,1]
!ifndef USE_WXBINDXRC
USE_WXBINDXRC = 1
!endif

# Does the wxLua debug support need to be compiled ? [0,1]
!ifndef USE_WXLUADEBUG
USE_WXLUADEBUG = 1
!endif

# Does the wxLua debug socket support need to be compiled ? [0,1]
!ifndef USE_WXLUASOCKET
USE_WXLUASOCKET = 1
!endif

# Compile the lua module ? [0,1]
!ifndef USE_LUAMODULE
USE_LUAMODULE = 1
!endif

# Build a monolithic Lua module ? [0,1]
!ifndef MONOLITHIC_LUAMODULE
MONOLITHIC_LUAMODULE = 0
!endif

# Compile the wxLua app ? [0,1]
!ifndef USE_WXLUAAPP
USE_WXLUAAPP = 1
!endif

# Compile the wxLuaCan app ? [0,1]
!ifndef USE_WXLUACANAPP
USE_WXLUACANAPP = 1
!endif

# The path to the wxStEdit component (meaningful only when USE_WXLUAEDITAPP==1) 
!ifndef WXSTEDIT_DIR
WXSTEDIT_DIR = $(WXSTEDIT)
!endif

# Compile the wxLuaEditor app ? [0,1]
!ifndef USE_WXLUAEDITAPP
USE_WXLUAEDITAPP = 0
!endif

# Compile the wxLuaFreeze app ? [0,1]
!ifndef USE_WXLUAFREEZEAPP
USE_WXLUAFREEZEAPP = 1
!endif



# -------------------------------------------------------------------------
# Do not modify the rest of this file!
# -------------------------------------------------------------------------

### Variables: ###

MAKEARGS = -DCC="$(CC)" -DCXX="$(CXX)" -DCFLAGS="$(CFLAGS)" \
	-DCXXFLAGS="$(CXXFLAGS)" -DCPPFLAGS="$(CPPFLAGS)" -DLDFLAGS="$(LDFLAGS)" \
	-DBUILD="$(BUILD)" -DUNICODE="$(UNICODE)" -DSHARED="$(SHARED)" \
	-DWX_SHARED="$(WX_SHARED)" -DWX_VERSION="$(WX_VERSION)" \
	-DWX_MONOLITHIC="$(WX_MONOLITHIC)" -DWX_DIR="$(WX_DIR)" \
	-DUSE_APPS="$(USE_APPS)" -DUSE_SYSTEM_LUA="$(USE_SYSTEM_LUA)" \
	-DLUA_INCLUDE_DIR="$(LUA_INCLUDE_DIR)" -DLUA_LIB_DIR="$(LUA_LIB_DIR)" \
	-DRUNTIME_LIBS="$(RUNTIME_LIBS)" -DTHREADING="$(THREADING)" \
	-DUSE_WXBINDADV="$(USE_WXBINDADV)" -DUSE_WXBINDAUI="$(USE_WXBINDAUI)" \
	-DUSE_WXBINDBASE="$(USE_WXBINDBASE)" -DUSE_WXBINDCORE="$(USE_WXBINDCORE)" \
	-DUSE_WXBINDGL="$(USE_WXBINDGL)" -DUSE_WXBINDHTML="$(USE_WXBINDHTML)" \
	-DUSE_WXBINDMEDIA="$(USE_WXBINDMEDIA)" -DUSE_WXBINDNET="$(USE_WXBINDNET)" \
	-DUSE_WXBINDRICHTEXT="$(USE_WXBINDRICHTEXT)" \
	-DUSE_WXBINDSTC="$(USE_WXBINDSTC)" -DUSE_WXBINDXML="$(USE_WXBINDXML)" \
	-DUSE_WXBINDXRC="$(USE_WXBINDXRC)" -DUSE_WXLUADEBUG="$(USE_WXLUADEBUG)" \
	-DUSE_WXLUASOCKET="$(USE_WXLUASOCKET)" -DUSE_LUAMODULE="$(USE_LUAMODULE)" \
	-DMONOLITHIC_LUAMODULE="$(MONOLITHIC_LUAMODULE)" \
	-DUSE_WXLUAAPP="$(USE_WXLUAAPP)" -DUSE_WXLUACANAPP="$(USE_WXLUACANAPP)" \
	-DWXSTEDIT_DIR="$(WXSTEDIT_DIR)" -DUSE_WXLUAEDITAPP="$(USE_WXLUAEDITAPP)" \
	-DUSE_WXLUAFREEZEAPP="$(USE_WXLUAFREEZEAPP)"

### Conditionally set variables: ###

!if "$(BUILD)" == "debug" && "$(UNICODE)" == "1"
WXLIBPOSTFIX = ud
!endif
!if "$(BUILD)" == "debug" && "$(UNICODE)" == "0"
WXLIBPOSTFIX = d
!endif
!if "$(BUILD)" == "release" && "$(UNICODE)" == "1"
WXLIBPOSTFIX = u
!endif
!if "$(WX_SHARED)" == "0"
WXLIBPATH = \lib\bcc_lib
!endif
!if "$(WX_SHARED)" == "1"
WXLIBPATH = \lib\bcc_dll
!endif
!if "$(SHARED)" == "0"
_BUILDDIR_SHARED_SUFFIX = 
!endif
!if "$(SHARED)" == "1"
_BUILDDIR_SHARED_SUFFIX = _dll
!endif
!if "$(USE_APPS)" == "1"
__apps___depname = apps
!endif


all: bccmsw$(WXLIBPOSTFIX)$(_BUILDDIR_SHARED_SUFFIX)
bccmsw$(WXLIBPOSTFIX)$(_BUILDDIR_SHARED_SUFFIX):
	-if not exist bccmsw$(WXLIBPOSTFIX)$(_BUILDDIR_SHARED_SUFFIX) mkdir bccmsw$(WXLIBPOSTFIX)$(_BUILDDIR_SHARED_SUFFIX)

### Targets: ###

all: test_for_selected_wxbuild modules $(__apps___depname)

clean: 
	-if exist bccmsw$(WXLIBPOSTFIX)$(_BUILDDIR_SHARED_SUFFIX)\*.obj del bccmsw$(WXLIBPOSTFIX)$(_BUILDDIR_SHARED_SUFFIX)\*.obj
	-if exist bccmsw$(WXLIBPOSTFIX)$(_BUILDDIR_SHARED_SUFFIX)\*.res del bccmsw$(WXLIBPOSTFIX)$(_BUILDDIR_SHARED_SUFFIX)\*.res
	-if exist bccmsw$(WXLIBPOSTFIX)$(_BUILDDIR_SHARED_SUFFIX)\*.csm del bccmsw$(WXLIBPOSTFIX)$(_BUILDDIR_SHARED_SUFFIX)\*.csm
	@echo cd ..\..\modules\build\msw >bccmsw$(WXLIBPOSTFIX)$(_BUILDDIR_SHARED_SUFFIX)\modules.bat
	@echo $(MAKE) -f makefile.bcc $(MAKEARGS) clean >>bccmsw$(WXLIBPOSTFIX)$(_BUILDDIR_SHARED_SUFFIX)\modules.bat
	call bccmsw$(WXLIBPOSTFIX)$(_BUILDDIR_SHARED_SUFFIX)\modules.bat
	@del bccmsw$(WXLIBPOSTFIX)$(_BUILDDIR_SHARED_SUFFIX)\modules.bat
	@echo cd ..\..\apps\build\msw >bccmsw$(WXLIBPOSTFIX)$(_BUILDDIR_SHARED_SUFFIX)\apps.bat
	@echo $(MAKE) -f makefile.bcc $(MAKEARGS) clean >>bccmsw$(WXLIBPOSTFIX)$(_BUILDDIR_SHARED_SUFFIX)\apps.bat
	call bccmsw$(WXLIBPOSTFIX)$(_BUILDDIR_SHARED_SUFFIX)\apps.bat
	@del bccmsw$(WXLIBPOSTFIX)$(_BUILDDIR_SHARED_SUFFIX)\apps.bat

test_for_selected_wxbuild: 
	@if not exist $(WX_DIR)$(WXLIBPATH)\msw$(WXLIBPOSTFIX)\wx\setup.h \
	echo ----------------------------------------------------------------------------
	@if not exist $(WX_DIR)$(WXLIBPATH)\msw$(WXLIBPOSTFIX)\wx\setup.h \
	echo The selected wxWidgets build is not available!
	@if not exist $(WX_DIR)$(WXLIBPATH)\msw$(WXLIBPOSTFIX)\wx\setup.h \
	echo Please use the options prefixed with WX_ to select another wxWidgets build.
	@if not exist $(WX_DIR)$(WXLIBPATH)\msw$(WXLIBPOSTFIX)\wx\setup.h \
	echo ----------------------------------------------------------------------------
	@if not exist $(WX_DIR)$(WXLIBPATH)\msw$(WXLIBPOSTFIX)\wx\setup.h \
	exit 1

modules: 
	@echo cd ..\..\modules\build\msw >bccmsw$(WXLIBPOSTFIX)$(_BUILDDIR_SHARED_SUFFIX)\modules.bat
	@echo $(MAKE) -f makefile.bcc $(MAKEARGS)  >>bccmsw$(WXLIBPOSTFIX)$(_BUILDDIR_SHARED_SUFFIX)\modules.bat
	call bccmsw$(WXLIBPOSTFIX)$(_BUILDDIR_SHARED_SUFFIX)\modules.bat
	@del bccmsw$(WXLIBPOSTFIX)$(_BUILDDIR_SHARED_SUFFIX)\modules.bat

!if "$(USE_APPS)" == "1"
apps: 
	@echo cd ..\..\apps\build\msw >bccmsw$(WXLIBPOSTFIX)$(_BUILDDIR_SHARED_SUFFIX)\apps.bat
	@echo $(MAKE) -f makefile.bcc $(MAKEARGS)  >>bccmsw$(WXLIBPOSTFIX)$(_BUILDDIR_SHARED_SUFFIX)\apps.bat
	call bccmsw$(WXLIBPOSTFIX)$(_BUILDDIR_SHARED_SUFFIX)\apps.bat
	@del bccmsw$(WXLIBPOSTFIX)$(_BUILDDIR_SHARED_SUFFIX)\apps.bat
!endif

docs: 
	@echo =============================================
	@echo Creating wxLua documentation using doxygen...
	@echo =============================================
	cd ../..\docs
	doxygen doxygen.cfg

compress: 
	@echo =============================================
	@echo Compressing wxLua binaries (requires UPX)...
	@echo =============================================
	cd ..\..\bin
	upx -9 --force *.exe
	cd ..\build\msw

