<?xml version="1.0" ?>

<!-- Author: Francesco Montorsi <frm@users.sourceforge.net>         -->
<!-- RCS-ID: $Id: modules.bkl,v 1.56 2008/01/21 05:08:40 jrl1 Exp $  -->


<!-- ====================================================================== -->
<!--                          WXLUA MODULES BAKEFILE                        -->
<!--                                                                        -->
<!--    The bakefile used to build all the modules.                         -->
<!-- ====================================================================== -->

<makefile>

    <!-- Contains stuff shared between this bakefile and the
         wxLua/modules/wxbind/build/wxbindcustom.bkl one -->
    <include file="common.bkl" once="1"/>


    <!-- Here it's important to use template_append and not just template ! -->
    <define-rule name="wxlua_stdlib" extends="wxluamodule_lib">
        <template template_append="wxluamodule-lib">
            <!-- always use wxLua's official wxluasetup.h for standard wxLua modules -->
            <include>$(WXLUA_BASEDIR)/modules/wxbind/setup</include>
        </template>
    </define-rule>
    <define-rule name="wxlua_stddll" extends="wxluamodule_dll">
        <template template_append="wxlua">
            <!-- always use wxLua's official wxluasetup.h for standard wxLua modules -->
            <include>$(WXLUA_BASEDIR)/modules/wxbind/setup</include>
        </template>
    </define-rule>





    <!-- ==================================================================  -->
    <!--                      The list of wxLua MODULES                      -->
    <!--                                                                     -->
    <!-- NOTE: the 'mod_' prefix in the ID is mainly because in this way the -->
    <!-- DSP files generated by this bakefile makes clear for the user what  -->
    <!-- is a module, what is an app (since app bakefile uses 'app_' prefix) -->
    <!-- and what is a util...                                               -->
    <!-- ==================================================================  -->

    <!-- HACK: instead of using the install-headers-to feature we currently
               need to use this <data-files> target because of this bakefile
               bug: http://www.bakefile.org/ticket/138 -->
    <data-files>
        <srcdir>$(SRCDIR)</srcdir>
        <files>$(LUA_HDR)</files>
        <install-to>$(INCLUDEDIR)</install-to>
    </data-files>

    <!-- the lua lib & dll: these are needed by all wxLua modules, specially for
         linking the "mod_luamodule" (see below); in fact, compiling statically the
         lua interpreter into "mod_luamodule" is not a Good Thing !
         See http://lua-users.org/wiki/BuildingModules to understand
         why (basically because lua core gets duplicated).

         NOTE: this is the vanilla lua interpreter and thus we _can_ and we
               _want_ to name it exactly like the "official" lua.
               In fact, it's very important that the mod_luamodule gets linked
               against a DSO/DLL named "lua5.1[.dll]" so that our "wx[.dll]"
               can be used just like any other Lua module.

         NOTE #2: we add template "wxlike" only to be sure that this lua library
                  will be built using the same DEBUG/RELEASE settings as for all
                  other libraries (wxlike will set <debug-info> basing on WX_DEBUG=0/1
                  which has been replaced by our BUILD=debug/release option).
    -->
    <lib id="lua_lib"
         template="wxlike"
         cond="SHARED=='0' and USE_SYSTEM_LUA=='0'">

        <wxlua-dirname>$(WXLUA_LIBDIR)</wxlua-dirname>
        <libname>lua5.1</libname>

        <sources>$(LUA_SRC)</sources>
        <headers>$(LUA_HDR)</headers>

        <install-to>$(LIBDIR)</install-to>

        <!-- see comment on the <data-files> above...

        <install-headers-to>$(PREFIX)</install-headers-to> -->

        <!-- see options.bkl for these -->
        <cflags>$(LUA_PLATFORM_SPECIFIC_CFLAGS)</cflags>
        <ldflags>$(LUA_PLATFORM_SPECIFIC_LDFLAGS)</ldflags>
    </lib>
    <dll id="lua_dll"
         template="wxlike"
         cond="SHARED=='1' and USE_SYSTEM_LUA=='0'">

        <wxlua-dirname>$(WXLUA_LIBDIR)</wxlua-dirname>
        <libname>lua5.1</libname>
        <dllname>lua5.1</dllname>

        <version>5.1.0</version>
        <so_version>0.0.0</so_version>
        <mac_version>51</mac_version>

        <sources>$(LUA_SRC)</sources>
        <headers>$(LUA_HDR)</headers>

        <install-to>$(LIBDIR)</install-to>

        <!-- see comment on the <data-files> above...

        <install-headers-to>$(PREFIX)</install-headers-to> -->

        <if cond="TARGETING_WIN32=='1'">
            <define>LUA_BUILD_AS_DLL</define>
        </if>

        <!-- see options.bkl for these -->
        <cflags>$(LUA_PLATFORM_SPECIFIC_CFLAGS)</cflags>
        <ldflags>$(LUA_PLATFORM_SPECIFIC_LDFLAGS)</ldflags>
    </dll>

    <!-- the wxLua lib & dll -->
    <wxlua_stdlib id="wxlua_lib" cond="SHARED=='0'">
        <module-name>WXLUA</module-name>
    </wxlua_stdlib>
    <wxlua_stddll id="wxlua_dll" cond="SHARED=='1'">
        <module-name>WXLUA</module-name>
        <module-dep>lua</module-dep>
    </wxlua_stddll>

    <!-- the wxBindAdv lib & dll -->
    <wxlua_stdlib id="wxbindadv_lib" cond="SHARED=='0' and USE_WXBINDADV=='1'">
        <module-name>WXBINDADV</module-name>
    </wxlua_stdlib>
    <wxlua_stddll id="wxbindadv_dll" cond="SHARED=='1' and USE_WXBINDADV=='1'">
        <module-name>WXBINDADV</module-name>
        <module-dep>wxbindbase</module-dep>
        <module-dep>wxbindcore</module-dep>
        <module-dep>wxlua</module-dep>
        <module-dep>lua</module-dep>
    </wxlua_stddll>

    <!-- the wxBindAUI lib & dll -->
    <wxlua_stdlib id="wxbindaui_lib" cond="SHARED=='0' and USE_WXBINDAUI=='1'">
        <module-name>WXBINDAUI</module-name>
    </wxlua_stdlib>
    <wxlua_stddll id="wxbindaui_dll" cond="SHARED=='1' and USE_WXBINDAUI=='1'">
        <module-name>WXBINDAUI</module-name>
        <module-dep>wxbindbase</module-dep>
        <module-dep>wxbindcore</module-dep>
        <module-dep>wxlua</module-dep>
        <module-dep>lua</module-dep>
        <wx-lib>aui</wx-lib>
    </wxlua_stddll>

    <!-- the wxBindBase lib & dll -->
    <wxlua_stdlib id="wxbindbase_lib" cond="SHARED=='0'">
        <module-name>WXBINDBASE</module-name>
    </wxlua_stdlib>
    <wxlua_stddll id="wxbindbase_dll" cond="SHARED=='1'">
        <module-name>WXBINDBASE</module-name>
        <module-dep>wxlua</module-dep>
        <module-dep>lua</module-dep>
    </wxlua_stddll>

    <!-- the wxBindCore lib & dll -->
    <wxlua_stdlib id="wxbindcore_lib" cond="SHARED=='0'">
        <module-name>WXBINDCORE</module-name>
    </wxlua_stdlib>
    <wxlua_stddll id="wxbindcore_dll" cond="SHARED=='1'">
        <module-name>WXBINDCORE</module-name>
        <module-dep>wxbindbase</module-dep>
        <module-dep>wxlua</module-dep>
        <module-dep>lua</module-dep>
    </wxlua_stddll>

    <!-- the wxBindGL lib & dll -->
    <wxlua_stdlib id="wxbindgl_lib" cond="SHARED=='0' and USE_WXBINDGL=='1'">
        <module-name>WXBINDGL</module-name>
    </wxlua_stdlib>
    <wxlua_stddll id="wxbindgl_dll" cond="SHARED=='1' and USE_WXBINDGL=='1'">
        <module-name>WXBINDGL</module-name>
        <module-dep>wxbindbase</module-dep>
        <module-dep>wxbindcore</module-dep>
        <module-dep>wxlua</module-dep>
        <module-dep>lua</module-dep>
    </wxlua_stddll>

    <!-- the wxBindHTML lib & dll -->
    <wxlua_stdlib id="wxbindhtml_lib" cond="SHARED=='0' and USE_WXBINDHTML=='1'">
        <module-name>WXBINDHTML</module-name>
    </wxlua_stdlib>
    <wxlua_stddll id="wxbindhtml_dll" cond="SHARED=='1' and USE_WXBINDHTML=='1'">
        <module-name>WXBINDHTML</module-name>
        <module-dep>wxbindbase</module-dep>
        <module-dep>wxbindcore</module-dep>
        <module-dep>wxlua</module-dep>
        <module-dep>lua</module-dep>
    </wxlua_stddll>

    <!-- the wxBindMedia lib & dll -->
    <wxlua_stdlib id="wxbindmedia_lib" cond="SHARED=='0' and USE_WXBINDMEDIA=='1'">
        <module-name>WXBINDMEDIA</module-name>
    </wxlua_stdlib>
    <wxlua_stddll id="wxbindmedia_dll" cond="SHARED=='1' and USE_WXBINDMEDIA=='1'">
        <module-name>WXBINDMEDIA</module-name>
        <module-dep>wxbindbase</module-dep>
        <module-dep>wxbindcore</module-dep>
        <module-dep>wxbindnet</module-dep>
        <module-dep>wxlua</module-dep>
        <module-dep>lua</module-dep>
    </wxlua_stddll>

    <!-- the wxBindNet lib & dll -->
    <wxlua_stdlib id="wxbindnet_lib" cond="SHARED=='0' and USE_WXBINDNET=='1'">
        <module-name>WXBINDNET</module-name>
    </wxlua_stdlib>
    <wxlua_stddll id="wxbindnet_dll" cond="SHARED=='1' and USE_WXBINDNET=='1'">
        <module-name>WXBINDNET</module-name>
        <module-dep>wxbindbase</module-dep>
        <module-dep>wxbindcore</module-dep>
        <module-dep>wxlua</module-dep>
        <module-dep>lua</module-dep>
    </wxlua_stddll>

    <!-- the wxBindRichText lib & dll -->
    <wxlua_stdlib id="wxbindrichtext_lib" cond="SHARED=='0' and USE_WXBINDRICHTEXT=='1'">
        <module-name>WXBINDRICHTEXT</module-name>
    </wxlua_stdlib>
    <wxlua_stddll id="wxbindrichtext_dll" cond="SHARED=='1' and USE_WXBINDRICHTEXT=='1'">
        <module-name>WXBINDRICHTEXT</module-name>
        <module-dep>wxbindbase</module-dep>
        <module-dep>wxbindcore</module-dep>
        <module-dep>wxlua</module-dep>
        <module-dep>lua</module-dep>
        <wx-lib>richtext</wx-lib>
    </wxlua_stddll>

    <!-- the wxBindSTC lib & dll -->
    <wxlua_stdlib id="wxbindstc_lib" cond="SHARED=='0' and USE_WXBINDSTC=='1'">
        <module-name>WXBINDSTC</module-name>
    </wxlua_stdlib>
    <wxlua_stddll id="wxbindstc_dll" cond="SHARED=='1' and USE_WXBINDSTC=='1'">
        <module-name>WXBINDSTC</module-name>
        <module-dep>wxbindbase</module-dep>
        <module-dep>wxbindcore</module-dep>
        <module-dep>wxlua</module-dep>
        <module-dep>lua</module-dep>
        <wx-lib>stc</wx-lib>
    </wxlua_stddll>

    <!-- the wxBindXML lib & dll -->
    <wxlua_stdlib id="wxbindxml_lib" cond="SHARED=='0' and USE_WXBINDXML=='1'">
        <module-name>WXBINDXML</module-name>
    </wxlua_stdlib>
    <wxlua_stddll id="wxbindxml_dll" cond="SHARED=='1' and USE_WXBINDXML=='1'">
        <module-name>WXBINDXML</module-name>
        <module-dep>wxbindbase</module-dep>
        <module-dep>wxlua</module-dep>
        <module-dep>lua</module-dep>
    </wxlua_stddll>

    <!-- the wxBindXRC lib & dll -->
    <wxlua_stdlib id="wxbindxrc_lib" cond="SHARED=='0' and USE_WXBINDXRC=='1'">
        <module-name>WXBINDXRC</module-name>
    </wxlua_stdlib>
    <wxlua_stddll id="wxbindxrc_dll" cond="SHARED=='1' and USE_WXBINDXRC=='1'">
        <module-name>WXBINDXRC</module-name>
        <module-dep>wxbindbase</module-dep>
        <module-dep>wxbindcore</module-dep>
        <module-dep>wxlua</module-dep>
        <module-dep>lua</module-dep>
    </wxlua_stddll>


    <!-- the wxLuaDebug lib & dll -->
    <wxlua_stdlib id="wxluadebug_lib" cond="SHARED=='0' and USE_WXLUADEBUG=='1'">
        <module-name>WXLUADEBUG</module-name>
    </wxlua_stdlib>
    <wxlua_stddll id="wxluadebug_dll" cond="SHARED=='1' and USE_WXLUADEBUG=='1'">
        <module-name>WXLUADEBUG</module-name>
        <module-dep>wxlua</module-dep>
        <module-dep>lua</module-dep>
    </wxlua_stddll>

    <!-- the wxLuaSocket lib & dll -->
    <wxlua_stdlib id="wxluasocket_lib" cond="SHARED=='0' and USE_WXLUASOCKET=='1'">
        <module-name>WXLUASOCKET</module-name>
    </wxlua_stdlib>
    <wxlua_stddll id="wxluasocket_dll" cond="SHARED=='1' and USE_WXLUASOCKET=='1'">
        <module-name>WXLUASOCKET</module-name>
        <module-dep>wxluadebug</module-dep>
        <module-dep>wxbindbase</module-dep>
        <module-dep>wxbindcore</module-dep>
        <module-dep>wxlua</module-dep>
        <module-dep>lua</module-dep>
    </wxlua_stddll>

    <!-- the luamodule: for lots of reasons it can be built only when SHARED==1 -->
    <module id="mod_luamodule" template="wxlua" cond="SHARED=='1' and USE_LUAMODULE=='1' and MONOLITHIC_LUAMODULE=='0'">
        <wxlua-dirname>$(WXLUA_LIBDIR)</wxlua-dirname>

        <!-- $libdir/lua/5.1 looks to be the standard folder for lua modules... -->
        <install-to>$(LIBDIR)/lua/5.1</install-to>

        <headers>$(LUAMODULE_HDR)</headers>
        <sources>$(LUAMODULE_SRC)</sources>
        <define>WXMAKINGDLL_LUAMODULE</define>

        <!-- It's important to keep the module name 'wx' to make require("wx") work -->
        <dllname>wx</dllname>

        <!-- we won't use <wxlua-allstdlibs> because it links to the non-verbatim
             version of lua, while we need the verbatim one (lua5.1.so/.dll) -->

        <wxlua-lib>wxbindstc</wxlua-lib>
        <wxlua-lib>wxbindaui</wxlua-lib>
        <wxlua-lib>wxbindxrc</wxlua-lib>
        <!-- <wxlua-lib>wxbindrichtext</wxlua-lib> -->
        <wxlua-lib>wxbindnet</wxlua-lib>
        <wxlua-lib>wxbindmedia</wxlua-lib>
        <wxlua-lib>wxbindhtml</wxlua-lib>
        <wxlua-lib>wxbindgl</wxlua-lib>
        <wxlua-lib>wxbindadv</wxlua-lib>
        <wxlua-lib>wxbindxml</wxlua-lib>
        <wxlua-lib>wxbindcore</wxlua-lib>
        <wxlua-lib>wxbindbase</wxlua-lib>

        <wxlua-lib>wxluasocket</wxlua-lib>
        <wxlua-lib>wxluadebug</wxlua-lib>
        <wxlua-lib>wxlua</wxlua-lib>
        <wxlua-lib>lua</wxlua-lib>

        <wx-alllibs-req-bywxlua/>
    </module>

    <!-- the luamodule: for lots of reasons it can be built only when SHARED==1 -->
    <module id="mod_luamodule_mono" template="wxlua" cond="SHARED=='1' and USE_LUAMODULE=='1' and MONOLITHIC_LUAMODULE=='1'">
        <wxlua-dirname>$(WXLUA_LIBDIR)</wxlua-dirname>

        <!-- $libdir/lua/5.1 looks to be the standard folder for lua modules... -->
        <install-to>$(LIBDIR)/lua/5.1</install-to>

        <include>$(WXLUA_BASEDIR)/modules/wxbind/setup</include>

        <!-- This is required because wxbind.h refers to wx contrib section, too -->
        <if cond="TARGETING_WIN32=='1'"><include>$(WX_DIR)/contrib/include</include></if>

        <headers>$(LUAMODULEMONO_HDR)</headers>
        <sources>$(LUAMODULEMONO_SRC)</sources>
        <define>WXMAKINGDLL_LUAMODULE</define>

        <!-- we don't need these exported, but otherwise they're set to use WXIMPORT -->
        <define>WXMAKINGDLL_WXBINDADV</define>
        <define>WXMAKINGDLL_WXBINDAUI</define>
        <define>WXMAKINGDLL_WXBINDBASE</define>
        <define>WXMAKINGDLL_WXBINDCORE</define>
        <define>WXMAKINGDLL_WXBINDGL</define>
        <define>WXMAKINGDLL_WXBINDHTML</define>
        <define>WXMAKINGDLL_WXBINDMEDIA</define>
        <define>WXMAKINGDLL_WXBINDNET</define>
        <define>WXMAKINGDLL_WXBINDRICHTEXT</define>
        <define>WXMAKINGDLL_WXBINDSTC</define>
        <define>WXMAKINGDLL_WXBINDXML</define>
        <define>WXMAKINGDLL_WXBINDXRC</define>

        <define>WXMAKINGDLL_WXLUADEBUG</define>
        <define>WXMAKINGDLL_WXLUASOCKET</define>
        <define>WXMAKINGDLL_WXLUA</define>

        <!-- use precomp for the bind sources to speed them up -->
        <precomp-headers-gen>
             wxbind/src/dummy.cpp
        </precomp-headers-gen>
        <precomp-headers-location>include</precomp-headers-location>
        <precomp-headers-header>wx/wxprec.h</precomp-headers-header>
        <precomp-headers-file>wxprec_$(id)</precomp-headers-file>
        <precomp-headers>on</precomp-headers>

        <!-- It's important to keep the module name 'wx' to make require("wx") work -->
        <dllname>wx</dllname>

        <!-- we won't use <wxlua-allstdlibs> because it links to the non-verbatim
             version of lua, while we need the verbatim one (lua5.1.so/.dll) -->

        <wxlua-lib>lua</wxlua-lib>
        <wx-lib>stc</wx-lib>

        <wx-alllibs-req-bywxlua/>
    </module>


    <!-- since all the previous targets would generate each one a different DSP project
         (i.e. a lot of project files), we instead tell Bakefile to merge the LIBS & DLLS
         targets so to generate only half of the DSP files -->
    <!-- NOTE: we use 'mod_' as prefix so that when opening the DSW file, the user immediately
         gets a good idea about what is a MODULE and what is an APP -->
    <set var="MSVC6PRJ_MERGED_TARGETS">
        mod_lua=lua_lib+lua_dll
        mod_wxlua=wxlua_lib+wxlua_dll
        mod_wxluadebug=wxluadebug_lib+wxluadebug_dll
        mod_wxluasocket=wxluasocket_lib+wxluasocket_dll

        mod_wxbindadv=wxbindadv_lib+wxbindadv_dll
        mod_wxbindaui=wxbindaui_lib+wxbindaui_dll
        mod_wxbindbase=wxbindbase_lib+wxbindbase_dll
        mod_wxbindcore=wxbindcore_lib+wxbindcore_dll
        mod_wxbindgl=wxbindgl_lib+wxbindgl_dll
        mod_wxbindhtml=wxbindhtml_lib+wxbindhtml_dll
        mod_wxbindmedia=wxbindmedia_lib+wxbindmedia_dll
        mod_wxbindnet=wxbindnet_lib+wxbindnet_dll
        mod_wxbindrichtext=wxbindrichtext_lib+wxbindrichtext_dll
        mod_wxbindstc=wxbindstc_lib+wxbindstc_dll
        mod_wxbindxml=wxbindxml_lib+wxbindxml_dll
        mod_wxbindxrc=wxbindxrc_lib+wxbindxrc_dll
    </set>


    <!-- Additionally, we need also to install wxBind's sources and the makefiles to compile
         them in case some other app want to extend them... (see modules/wxbind/build/wxbindcustom.bkl)
    -->
    <if cond="TARGETING_UNIX=='1'">

        <set var="OUT_SRCDIR">$(DESTDIR)$(PREFIX)/src/wxbind</set>
        <set var="OUT_INCLUDEDIR">$(DESTDIR)$(PREFIX)/include/wxbind</set>

        <copy-files id="wxbindsrc" cond="INSTALL_CUSTOM_WXBIND=='1'">
            <dependency-of>install</dependency-of>
            <srcdir>$(top_srcdir)/modules</srcdir>
            <dstdir>$(OUT_SRCDIR)</dstdir>
            <files>$(fileList('wxbind/src/*.cpp'))</files>
        </copy-files>
        <copy-files id="wxbindmake" cond="INSTALL_CUSTOM_WXBIND=='1'">
            <dependency-of>install</dependency-of>
            <srcdir>$(top_srcdir)/modules</srcdir>
            <dstdir>$(OUT_SRCDIR)/build</dstdir>
            <files>$(fileList('wxbind/build/makefile*'))</files>
        </copy-files>

        <copy-files id="wxbindsetup" cond="INSTALL_CUSTOM_WXBIND=='1'">
            <dependency-of>install</dependency-of>
            <srcdir>$(top_srcdir)/modules</srcdir>
            <dstdir>$(OUT_INCLUDEDIR)/setup</dstdir>
            <files>wxbind/setup/wxluasetup.h</files>
        </copy-files>
    </if>

</makefile>
